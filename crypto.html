<!DOCTYPE html>
<html>
   <Title>Text Encryption App</Title>
	<head>
	<style type="text/css">
	#qr-canvas{ display:none; }
	</style>
	<script src="jquery-1.12.4.js"></script>
	<script src="jquery-ui.js"></script>
	<script src="crypto.js"></script>	
	<script type="text/javascript" src="webqr.js"></script>
	<script type="text/javascript" src="llqrcode.js"></script>
	</head>   
	<body>
	<div id="header">Text Encryption</div>	
	<form>
	  <textarea id='msg' name="Message" rows="15" cols="45" valign="top" align="center" style="font-size:25px; border:solid 1px orange;"></textarea>
	  <br />
	  <div id="outdiv">passphrase:
	  <div id="result"></div>
	  <input type="file" id="fn" onchange="handleFiles(this.files)"/></div>
	  <input type="button" onClick="encryption()" value="Encrypt"/>
	  <input type="button" onClick="decryption()" value="Decrypt"/>
	  <input type="button" onClick="definekey()" value="Keypass"/>	  
	  <br />
	</form>
	<canvas id="qr-canvas" width="800" height="600"></canvas>
	<script type="text/javascript">	
		var codedString = "";
		var msg = "";
		initCanvas(800, 600);
		qrcode.callback = read;
		function definekey() {
		  var keypass = document.getElementById("result").innerHTML;
		  keypass = keypass.replace("</b>","<b>").split("<b>")[1];
		  if (typeof keypass == 'undefined')
			keypass = "password";
			var txt = prompt("Enter key pass code:",keypass);
			keypass = "<b>" + txt + "</b>"
			document.getElementById("result").innerHTML = keypass;
		}
        function encryption() {
          var msg = document.getElementById('msg').value;
		  if (msg=="") {
			alert("There is nothing to encrypt.");
			return;
		  }		  
		  var txt = document.getElementById("result").innerHTML;
		  var keypass = txt.replace("</b>","<b>").split("<b>")[1];
		  if (typeof keypass == 'undefined')
			keypass = "";
		  if (keypass=="") {
			alert("Please load the passphrase file!");
			return;
		  }
		  codedString =  CryptoJS.Rabbit.encrypt(msg, keypass);
		  document.getElementById("msg").value = codedString;
        }
        function decryption() {
          var msg = document.getElementById('msg').value;
		  if (msg=="") {
			alert("There is nothing to decrypt.");
			return;
		  }		  
		  var txt = document.getElementById("result").innerHTML;
		  var keypass = txt.replace("</b>","<b>").split("<b>")[1];
		  if (typeof keypass == 'undefined')
			keypass = "";
		  if (keypass=="") {
			alert("Please load the passphrase file!");
			return;
		  }
		  codedString =  CryptoJS.Rabbit.decrypt(msg, keypass).toString(CryptoJS.enc.Utf8);
  		  document.getElementById("msg").value = codedString;
        }
	</script>
	</body>
</html>