<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8" />
<meta name="Infobase.html-web-app-capable" content="yes">
<style>
body { font-family: Arial, Helvetica, sans-serif; background-color: white; margin: 0; }
#dialog{ width: 50%; margin-left: 5%; }
.fhir { font-family: arial, sans-serif; border-collapse: collapse; max-width: 90%; white-space:nowrap; background-color: #95A5A6 ; }
</style>
<base target="_top" />

</head>
<body>
<div id="hdr" style="padding:0 16px">  
  <h3>Infobase for e-Referral processes by Kim Huat</h3>
  <p>This is a prototype for translating the ACO ICO Requirements into design framework 
    using <a href="https://open.epic.com/Home/Interoperate">open source EPIC api.</a>.</p>
</div>
<hr>
<br />
<div id="dialog"><input type="button" value="Main page" onclick="goback()" style="font-size:20px;"/>
&nbsp&nbsp<input type="button" value="Previous page" onclick="prev_page()" style="font-size:20px;"/>
&nbsp&nbsp<input type="button" value="Github" onclick="github()" style="font-size:20px;"/>
</div>
<br />
<br />

<div id="result" style="border: none;"><br><h3>API Information (click on below):</h3>
<br><a class="blue" onclick="fhir_info('Account')">Account</a>
<br><a class="blue" onclick="fhir_info('ActivityDefinition')">ActivityDefinition</a>
<br><a class="blue" onclick="fhir_info('AdverseEvent')">AdverseEvent</a>
<br><a class="blue" onclick="fhir_info('AllergyIntolerance')">AllergyIntolerance</a>
<br><a class="blue" onclick="fhir_info('Appointment')">Appointment</a>
<br><a class="blue" onclick="fhir_info('AppointmentResponse')">AppointmentResponse</a>
<br><a class="blue" onclick="fhir_info('AuditEvent')">AuditEvent</a>
<br><a class="blue" onclick="fhir_info('Basic')">Basic</a>
<br><a class="blue" onclick="fhir_info('Binary')">Binary</a>
<br><a class="blue" onclick="fhir_info('BiologicallyDerivedProduct')">BiologicallyDerivedProduct</a>
<br><a class="blue" onclick="fhir_info('BodyStructure')">BodyStructure</a>
<br><a class="blue" onclick="fhir_info('Bundle')">Bundle</a>
<br><a class="blue" onclick="fhir_info('CapabilityStatement')">CapabilityStatement</a>
<br><a class="blue" onclick="fhir_info('CarePlan')">CarePlan</a>
<br><a class="blue" onclick="fhir_info('CareTeam')">CareTeam</a>
<br><a class="blue" onclick="fhir_info('CatalogEntry')">CatalogEntry</a>
<br><a class="blue" onclick="fhir_info('ChargeItem')">ChargeItem</a>
<br><a class="blue" onclick="fhir_info('ChargeItemDefinition')">ChargeItemDefinition</a>
<br><a class="blue" onclick="fhir_info('Claim')">Claim</a>
<br><a class="blue" onclick="fhir_info('ClaimResponse')">ClaimResponse</a>
<br><a class="blue" onclick="fhir_info('ClinicalImpression')">ClinicalImpression</a>
<br><a class="blue" onclick="fhir_info('CodeSystem')">CodeSystem</a>
<br><a class="blue" onclick="fhir_info('Communication')">Communication</a>
<br><a class="blue" onclick="fhir_info('CommunicationRequest')">CommunicationRequest</a>
<br><a class="blue" onclick="fhir_info('CompartmentDefinition')">CompartmentDefinition</a>
<br><a class="blue" onclick="fhir_info('Composition')">Composition</a>
<br><a class="blue" onclick="fhir_info('ConceptMap')">ConceptMap</a>
<br><a class="blue" onclick="fhir_info('Condition')">Condition</a>
<br><a class="blue" onclick="fhir_info('Consent')">Consent</a>
<br><a class="blue" onclick="fhir_info('Contract')">Contract</a>
<br><a class="blue" onclick="fhir_info('Coverage')">Coverage</a>
<br><a class="blue" onclick="fhir_info('CoverageEligibilityRequest')">CoverageEligibilityRequest</a>
<br><a class="blue" onclick="fhir_info('CoverageEligibilityResponse')">CoverageEligibilityResponse</a>
<br><a class="blue" onclick="fhir_info('DetectedIssue')">DetectedIssue</a>
<br><a class="blue" onclick="fhir_info('Device')">Device</a>
<br><a class="blue" onclick="fhir_info('DeviceDefinition')">DeviceDefinition</a>
<br><a class="blue" onclick="fhir_info('DeviceMetric')">DeviceMetric</a>
<br><a class="blue" onclick="fhir_info('DeviceRequest')">DeviceRequest</a>
<br><a class="blue" onclick="fhir_info('DeviceUseStatement')">DeviceUseStatement</a>
<br><a class="blue" onclick="fhir_info('DiagnosticReport')">DiagnosticReport</a>
<br><a class="blue" onclick="fhir_info('DocumentManifest')">DocumentManifest</a>
<br><a class="blue" onclick="fhir_info('DocumentReference')">DocumentReference</a>
<br><a class="blue" onclick="fhir_info('EffectEvidenceSynthesis')">EffectEvidenceSynthesis</a>
<br><a class="blue" onclick="fhir_info('Encounter')">Encounter</a>
<br><a class="blue" onclick="fhir_info('Endpoint')">Endpoint</a>
<br><a class="blue" onclick="fhir_info('EnrollmentRequest')">EnrollmentRequest</a>
<br><a class="blue" onclick="fhir_info('EnrollmentResponse')">EnrollmentResponse</a>
<br><a class="blue" onclick="fhir_info('EpisodeOfCare')">EpisodeOfCare</a>
<br><a class="blue" onclick="fhir_info('EventDefinition')">EventDefinition</a>
<br><a class="blue" onclick="fhir_info('Evidence')">Evidence</a>
<br><a class="blue" onclick="fhir_info('EvidenceVariable')">EvidenceVariable</a>
<br><a class="blue" onclick="fhir_info('ExampleScenario')">ExampleScenario</a>
<br><a class="blue" onclick="fhir_info('ExplanationOfBenefit')">ExplanationOfBenefit</a>
<br><a class="blue" onclick="fhir_info('FamilyMemberHistory')">FamilyMemberHistory</a>
<br><a class="blue" onclick="fhir_info('Flag')">Flag</a>
<br><a class="blue" onclick="fhir_info('Goal')">Goal</a>
<br><a class="blue" onclick="fhir_info('GraphDefinition')">GraphDefinition</a>
<br><a class="blue" onclick="fhir_info('Group')">Group</a>
<br><a class="blue" onclick="fhir_info('GuidanceResponse')">GuidanceResponse</a>
<br><a class="blue" onclick="fhir_info('HealthcareService')">HealthcareService</a>
<br><a class="blue" onclick="fhir_info('ImagingStudy')">ImagingStudy</a>
<br><a class="blue" onclick="fhir_info('Immunization')">Immunization</a>
<br><a class="blue" onclick="fhir_info('ImmunizationEvaluation')">ImmunizationEvaluation</a>
<br><a class="blue" onclick="fhir_info('ImmunizationRecommendation')">ImmunizationRecommendation</a>
<br><a class="blue" onclick="fhir_info('ImplementationGuide')">ImplementationGuide</a>
<br><a class="blue" onclick="fhir_info('InsurancePlan')">InsurancePlan</a>
<br><a class="blue" onclick="fhir_info('Invoice')">Invoice</a>
<br><a class="blue" onclick="fhir_info('Library')">Library</a>
<br><a class="blue" onclick="fhir_info('Linkage')">Linkage</a>
<br><a class="blue" onclick="fhir_info('List')">List</a>
<br><a class="blue" onclick="fhir_info('Location')">Location</a>
<br><a class="blue" onclick="fhir_info('Measure')">Measure</a>
<br><a class="blue" onclick="fhir_info('MeasureReport')">MeasureReport</a>
<br><a class="blue" onclick="fhir_info('Media')">Media</a>
<br><a class="blue" onclick="fhir_info('Medication')">Medication</a>
<br><a class="blue" onclick="fhir_info('MedicationAdministration')">MedicationAdministration</a>
<br><a class="blue" onclick="fhir_info('MedicationDispense')">MedicationDispense</a>
<br><a class="blue" onclick="fhir_info('MedicationKnowledge')">MedicationKnowledge</a>
<br><a class="blue" onclick="fhir_info('MedicationRequest')">MedicationRequest</a><
br><a class="blue" onclick="fhir_info('MedicationStatement')">MedicationStatement</a>
<br><a class="blue" onclick="fhir_info('MedicinalProduct')">MedicinalProduct</a>
<br><a class="blue" onclick="fhir_info('MedicinalProductAuthorization')">MedicinalProductAuthorization</a>
<br><a class="blue" onclick="fhir_info('MedicinalProductContraindication')">MedicinalProductContraindication</a>
<br><a class="blue" onclick="fhir_info('MedicinalProductIndication')">MedicinalProductIndication</a>
<br><a class="blue" onclick="fhir_info('MedicinalProductIngredient')">MedicinalProductIngredient</a>
<br><a class="blue" onclick="fhir_info('MedicinalProductInteraction')">MedicinalProductInteraction</a>
<br><a class="blue" onclick="fhir_info('MedicinalProductManufactured')">MedicinalProductManufactured</a>
<br><a class="blue" onclick="fhir_info('MedicinalProductPackaged')">MedicinalProductPackaged</a>
<br><a class="blue" onclick="fhir_info('MedicinalProductPharmaceutical')">MedicinalProductPharmaceutical</a>
<br><a class="blue" onclick="fhir_info('MedicinalProductUndesirableEffect')">MedicinalProductUndesirableEffect</a>
<br><a class="blue" onclick="fhir_info('MessageDefinition')">MessageDefinition</a>
<br><a class="blue" onclick="fhir_info('MessageHeader')">MessageHeader</a>
<br><a class="blue" onclick="fhir_info('MolecularSequence')">MolecularSequence</a>
<br><a class="blue" onclick="fhir_info('NamingSystem')">NamingSystem</a>
<br><a class="blue" onclick="fhir_info('NutritionOrder')">NutritionOrder</a>
<br><a class="blue" onclick="fhir_info('Observation')">Observation</a>
<br><a class="blue" onclick="fhir_info('ObservationDefinition')">ObservationDefinition</a>
<br><a class="blue" onclick="fhir_info('OperationDefinition')">OperationDefinition</a>
<br><a class="blue" onclick="fhir_info('OperationOutcome')">OperationOutcome</a>
<br><a class="blue" onclick="fhir_info('Organization')">Organization</a>
<br><a class="blue" onclick="fhir_info('OrganizationAffiliation')">OrganizationAffiliation</a>
<br><a class="blue" onclick="fhir_info('Parameters')">Parameters</a>
<br><a class="blue" onclick="fhir_info('Patient')">Patient</a>
<br><a class="blue" onclick="fhir_info('PaymentNotice')">PaymentNotice</a>
<br><a class="blue" onclick="fhir_info('PaymentReconciliation')">PaymentReconciliation</a>
<br><a class="blue" onclick="fhir_info('Person')">Person</a>
<br><a class="blue" onclick="fhir_info('PlanDefinition')">PlanDefinition</a>
<br><a class="blue" onclick="fhir_info('Practitioner')">Practitioner</a>
<br><a class="blue" onclick="fhir_info('PractitionerRole')">PractitionerRole</a>
<br><a class="blue" onclick="fhir_info('Procedure')">Procedure</a>
<br><a class="blue" onclick="fhir_info('Provenance')">Provenance</a>
<br><a class="blue" onclick="fhir_info('Questionnaire')">Questionnaire</a>
<br><a class="blue" onclick="fhir_info('QuestionnaireResponse')">QuestionnaireResponse</a>
<br><a class="blue" onclick="fhir_info('RelatedPerson')">RelatedPerson</a>
<br><a class="blue" onclick="fhir_info('RequestGroup')">RequestGroup</a>
<br><a class="blue" onclick="fhir_info('ResearchDefinition')">ResearchDefinition</a>
<br><a class="blue" onclick="fhir_info('ResearchElementDefinition')">ResearchElementDefinition</a>
<br><a class="blue" onclick="fhir_info('ResearchStudy')">ResearchStudy</a>
<br><a class="blue" onclick="fhir_info('ResearchSubject')">ResearchSubject</a>
<br><a class="blue" onclick="fhir_info('RiskAssessment')">RiskAssessment</a>
<br><a class="blue" onclick="fhir_info('RiskEvidenceSynthesis')">RiskEvidenceSynthesis</a>
<br><a class="blue" onclick="fhir_info('Schedule')">Schedule</a>
<br><a class="blue" onclick="fhir_info('SearchParameter')">SearchParameter</a>
<br><a class="blue" onclick="fhir_info('ServiceRequest')">ServiceRequest</a>
<br><a class="blue" onclick="fhir_info('Slot')">Slot</a>
<br><a class="blue" onclick="fhir_info('Specimen')">Specimen</a>
<br><a class="blue" onclick="fhir_info('SpecimenDefinition')">SpecimenDefinition</a>
<br><a class="blue" onclick="fhir_info('StructureDefinition')">StructureDefinition</a>
<br><a class="blue" onclick="fhir_info('StructureMap')">StructureMap</a>
<br><a class="blue" onclick="fhir_info('Subscription')">Subscription</a>
<br><a class="blue" onclick="fhir_info('Substance')">Substance</a>
<br><a class="blue" onclick="fhir_info('SubstanceNucleicAcid')">SubstanceNucleicAcid</a>
<br><a class="blue" onclick="fhir_info('SubstancePolymer')">SubstancePolymer</a>
<br><a class="blue" onclick="fhir_info('SubstanceProtein')">SubstanceProtein</a>
<br><a class="blue" onclick="fhir_info('SubstanceReferenceInformation')">SubstanceReferenceInformation</a>
<br><a class="blue" onclick="fhir_info('SubstanceSourceMaterial')">SubstanceSourceMaterial</a>
<br><a class="blue" onclick="fhir_info('SubstanceSpecification')">SubstanceSpecification</a>
<br><a class="blue" onclick="fhir_info('SupplyDelivery')">SupplyDelivery</a>
<br><a class="blue" onclick="fhir_info('SupplyRequest')">SupplyRequest</a>
<br><a class="blue" onclick="fhir_info('Task')">Task</a>
<br><a class="blue" onclick="fhir_info('TerminologyCapabilities')">TerminologyCapabilities</a>
<br><a class="blue" onclick="fhir_info('TestReport')">TestReport</a>
<br><a class="blue" onclick="fhir_info('TestScript')">TestScript</a>
<br><a class="blue" onclick="fhir_info('ValueSet')">ValueSet</a>
<br><a class="blue" onclick="fhir_info('VerificationResult')">VerificationResult</a>
<br><a class="blue" onclick="fhir_info('VisionPrescription')">VisionPrescription</a><br></div>
<br>
<br>

<script>
	let api_hdr = "http://hapi.fhir.org/baseR4/";
	let home_url = "https://wingsmaker.github.io/crypto/";
	let workflow_html = document.getElementById("result").innerHTML;  
	let prev_html = workflow_html;	

	function goback() {
		var url = home_url + "Infobase.html";
		window.top.location.href = url;
	}

	function prev_page() {
		curr_html = document.getElementById("result").innerHTML;
		document.getElementById("result").innerHTML = ( curr_html == prev_html)? workflow_html : prev_html;
	}

	function json2html(resp, resp_title) {
		var ref_pattern = /[A-Z].*[a-z]\/.*[0-9].*[^=]$/;
		var resp_list = resp.split('\n');
		resp_list = resp_list.filter(function(x) { return x.includes(":") && x.length > 0 } );
		resp_list = resp_list.filter(function(x) { return x.split(":")[1].includes('"') } );
		resp_list = resp_list.map(function(x) { return x.replace('",','').replaceAll('"','') });
		resp_list = resp_list.map(function(x) { return x.split(': ') });
		resp_list = resp_list.filter(function(x) { return x.length == 2 } );
		resp_list = resp_list.filter(function(x) { return x[1].length < 120 } );
		resp_html = resp_list.toString();
		return resp_html;
		if ( false ) {
			var resp_list1 = resp_list;
			var resp_list2 = resp_list;  
			resp_list1 = resp_list1.filter(function(x) { return (x[1].match(ref_pattern) && x[1].length < 80) } );
			resp_list2 = resp_list2.filter(function(x) { return (x[1].match(ref_pattern) && x[1].length < 80)?false:true;});
			var resp_list3 = resp_list1.map(function(x) { return x[1] });
			resp_list3 = resp_list3.map(function(x) { return x.replaceAll(api_hdr,'') });
			resp_list3 = resp_list3.filter(function(x) { return x.includes("http://") == false } );
			resp_list3 = resp_list3.filter(function(x) { return x.match(/^[A-Za-z].*/) } );
			resp_list3 = resp_list3.map(function(x) { return x.replace('/','_').split('/')[0].replace('_','/') });
			resp_list3 = resp_list3.sort();  
			resp_list3 = [...new Set(resp_list3)];
			var resp_list4 = resp_list3.map(function(x) { return x.split('/')[0] });
			resp_list4 = resp_list4.sort();
			resp_list4 = [...new Set(resp_list4)];
			var resp_txt = "";
			resp_list4.forEach( function(x){ resp_txt += (x + '<br/>\n&nbsp&nbsp&nbsp' + resp_list3.filter( function(y) { return y.includes( x + '/')} ).map( function(z) { return html_ref(z) }).join('<br/>\n&nbsp&nbsp&nbsp') + '<br/>\n') }) ;
			var resp_html = '<div style="width: 90%; font-size: 16px;"><h2>' + resp_title + '</h2><br/><br/>';
			if (resp_txt.length > 0 ) {
				resp_html += '<p>Reference info (click on below):</p>' + resp_txt + '<br/><br/>';
			} else {
				resp_html += "<br/>";
			}
			resp_html = resp_html + list2html(resp_list) + "</div>";
			return resp_html;
		}
	}

	function list2html(resp_list) {
		var resp_html = resp_list.map(function(x) { return x.map(function(y) { return "<td>" + y + "</td>" })});
		resp_html = resp_html.map(function(x) { return "<tr>" + x.join('') + "</tr>" });
		resp_html = '<table class="fhir"><tr><th style="width: 20%">Code</th><th style="width: 70%">Desc</th></tr>' + resp_html.join('') + '</table>';
		return resp_html;
	}

	function html_ref(tag) {
		var ref_pattern = /[A-Z].*[a-z]\/.*[0-9].*[^=]$/;
		if ( tag.match(ref_pattern) ) {
			var tag_list = tag.split('/');
			var varx = tag_list[0];
			var vary = tag_list[1];
			var varz = '<a class="blue" onclick="fhir_info(\'' + varx + '\',\'' + vary + '\')">' + vary + '</a>';
			return varz;
		}
		return tag;
	}

	function fhir_info(api_name) {
		var resp_title = "";
		var api_data = "_history";
		var apiurl = api_hdr + api_name + "/"+ api_data;
		var resp_title = api_name + " history";
		resp_title = resp_title.replace("_","");
		prev_html = document.getElementById("result").innerHTML;
		var xhttp = new XMLHttpRequest();
		xhttp.open('POST', apiurl, true);
		xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		document.getElementById("result").innerHTML = "";
		xhttp.onload  = function() {
			var resp = this.responseText;
			var txt = json2html(resp, resp_title);
			document.getElementById("result").innerHTML = txt;
			document.getElementById("hdr").innerHTML = resp;
		}
		xhttp.send();
	}
	
	function github() {
		url = "https://github.com/WingsMaker/crypto/tree/main/docs";
		window.open(url);
	}
</script>
</body>
</html>
