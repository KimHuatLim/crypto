<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8" />
<meta name="Infobase.html-web-app-capable" content="yes">
<style>
body { font-family: Arial, Helvetica, sans-serif; background-color: white; margin: 0; }
#dialog{ width: 50%; margin-left: 5%; }
.fhir { font-family: arial, sans-serif; border-collapse: collapse; max-width: 90%; white-space:nowrap; background-color: #95A5A6 ; }
</style>
<base target="_top" />

</head>
<body>
<div id="hdr" style="padding:0 16px">  
  <h3>Infobase for e-Referral processes by Kim Huat</h3>
  <p>This is a prototype for translating the ACO ICO Requirements into design framework 
    using <a href="https://open.epic.com/Home/Interoperate">open source EPIC api.</a>.</p>
</div>
<hr>
<br />
<div id="dialog"><input type="button" id="up" value="Main page" onclick="goback()" style="font-size:20px;"/>
&nbsp&nbsp<input type="button" id="prev" value="Previous page" onclick="prev_page()" style="font-size:20px;"/>
</div>
<br />
<br />

<div id="result" style="border: none;"><br><h3>API Information:</h3>
<br><table>
<tr><td><a class="blue" onclick="fhir_info('Account')">Account</a></td><td><a class="blue" onclick="fhir_info('Coverage')">Coverage</a></td><td><a class="blue" onclick="fhir_info('ImagingStudy')">ImagingStudy</a></td><td><a class="blue" onclick="fhir_info('MessageDefinition')">MessageDefinition</a></td><td><a class="blue" onclick="fhir_info('RiskEvidenceSynthesis')">RiskEvidenceSynthesis</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('ActivityDefinition')">ActivityDefinition</a></td><td><a class="blue" onclick="fhir_info('CoverageEligibilityRequest')">CoverageEligibilityRequest</a></td><td><a class="blue" onclick="fhir_info('Immunization')">Immunization</a></td><td><a class="blue" onclick="fhir_info('MessageHeader')">MessageHeader</a></td><td><a class="blue" onclick="fhir_info('Schedule')">Schedule</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('AdverseEvent')">AdverseEvent</a></td><td><a class="blue" onclick="fhir_info('CoverageEligibilityResponse')">CoverageEligibilityResponse</a></td><td><a class="blue" onclick="fhir_info('ImmunizationEvaluation')">ImmunizationEvaluation</a></td><td><a class="blue" onclick="fhir_info('MolecularSequence')">MolecularSequence</a></td><td><a class="blue" onclick="fhir_info('SearchParameter')">SearchParameter</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('AllergyIntolerance')">AllergyIntolerance</a></td><td><a class="blue" onclick="fhir_info('DetectedIssue')">DetectedIssue</a></td><td><a class="blue" onclick="fhir_info('ImmunizationRecommendation')">ImmunizationRecommendation</a></td><td><a class="blue" onclick="fhir_info('NamingSystem')">NamingSystem</a></td><td><a class="blue" onclick="fhir_info('ServiceRequest')">ServiceRequest</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('Appointment')">Appointment</a></td><td><a class="blue" onclick="fhir_info('Device')">Device</a></td><td><a class="blue" onclick="fhir_info('ImplementationGuide')">ImplementationGuide</a></td><td><a class="blue" onclick="fhir_info('NutritionOrder')">NutritionOrder</a></td><td><a class="blue" onclick="fhir_info('Slot')">Slot</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('AppointmentResponse')">AppointmentResponse</a></td><td><a class="blue" onclick="fhir_info('DeviceDefinition')">DeviceDefinition</a></td><td><a class="blue" onclick="fhir_info('InsurancePlan')">InsurancePlan</a></td><td><a class="blue" onclick="fhir_info('Observation')">Observation</a></td><td><a class="blue" onclick="fhir_info('Specimen')">Specimen</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('AuditEvent')">AuditEvent</a></td><td><a class="blue" onclick="fhir_info('DeviceMetric')">DeviceMetric</a></td><td><a class="blue" onclick="fhir_info('Invoice')">Invoice</a></td><td><a class="blue" onclick="fhir_info('ObservationDefinition')">ObservationDefinition</a></td><td><a class="blue" onclick="fhir_info('SpecimenDefinition')">SpecimenDefinition</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('Basic')">Basic</a></td><td><a class="blue" onclick="fhir_info('DeviceRequest')">DeviceRequest</a></td><td><a class="blue" onclick="fhir_info('Library')">Library</a></td><td><a class="blue" onclick="fhir_info('OperationDefinition')">OperationDefinition</a></td><td><a class="blue" onclick="fhir_info('StructureDefinition')">StructureDefinition</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('Binary')">Binary</a></td><td><a class="blue" onclick="fhir_info('DeviceUseStatement')">DeviceUseStatement</a></td><td><a class="blue" onclick="fhir_info('Linkage')">Linkage</a></td><td><a class="blue" onclick="fhir_info('OperationOutcome')">OperationOutcome</a></td><td><a class="blue" onclick="fhir_info('StructureMap')">StructureMap</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('BiologicallyDerivedProduct')">BiologicallyDerivedProduct</a></td><td><a class="blue" onclick="fhir_info('DiagnosticReport')">DiagnosticReport</a></td><td><a class="blue" onclick="fhir_info('List')">List</a></td><td><a class="blue" onclick="fhir_info('Organization')">Organization</a></td><td><a class="blue" onclick="fhir_info('Subscription')">Subscription</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('BodyStructure')">BodyStructure</a></td><td><a class="blue" onclick="fhir_info('DocumentManifest')">DocumentManifest</a></td><td><a class="blue" onclick="fhir_info('Location')">Location</a></td><td><a class="blue" onclick="fhir_info('OrganizationAffiliation')">OrganizationAffiliation</a></td><td><a class="blue" onclick="fhir_info('Substance')">Substance</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('Bundle')">Bundle</a></td><td><a class="blue" onclick="fhir_info('DocumentReference')">DocumentReference</a></td><td><a class="blue" onclick="fhir_info('Measure')">Measure</a></td><td><a class="blue" onclick="fhir_info('Parameters')">Parameters</a></td><td><a class="blue" onclick="fhir_info('SubstanceNucleicAcid')">SubstanceNucleicAcid</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('CapabilityStatement')">CapabilityStatement</a></td><td><a class="blue" onclick="fhir_info('EffectEvidenceSynthesis')">EffectEvidenceSynthesis</a></td><td><a class="blue" onclick="fhir_info('MeasureReport')">MeasureReport</a></td><td><a class="blue" onclick="fhir_info('Patient')">Patient</a></td><td><a class="blue" onclick="fhir_info('SubstancePolymer')">SubstancePolymer</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('CarePlan')">CarePlan</a></td><td><a class="blue" onclick="fhir_info('Encounter')">Encounter</a></td><td><a class="blue" onclick="fhir_info('Media')">Media</a></td><td><a class="blue" onclick="fhir_info('PaymentNotice')">PaymentNotice</a></td><td><a class="blue" onclick="fhir_info('SubstanceProtein')">SubstanceProtein</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('CareTeam')">CareTeam</a></td><td><a class="blue" onclick="fhir_info('Endpoint')">Endpoint</a></td><td><a class="blue" onclick="fhir_info('Medication')">Medication</a></td><td><a class="blue" onclick="fhir_info('PaymentReconciliation')">PaymentReconciliation</a></td><td><a class="blue" onclick="fhir_info('SubstanceReferenceInformation')">SubstanceReferenceInformation</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('CatalogEntry')">CatalogEntry</a></td><td><a class="blue" onclick="fhir_info('EnrollmentRequest')">EnrollmentRequest</a></td><td><a class="blue" onclick="fhir_info('MedicationAdministration')">MedicationAdministration</a></td><td><a class="blue" onclick="fhir_info('Person')">Person</a></td><td><a class="blue" onclick="fhir_info('SubstanceSourceMaterial')">SubstanceSourceMaterial</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('ChargeItem')">ChargeItem</a></td><td><a class="blue" onclick="fhir_info('EnrollmentResponse')">EnrollmentResponse</a></td><td><a class="blue" onclick="fhir_info('MedicationDispense')">MedicationDispense</a></td><td><a class="blue" onclick="fhir_info('PlanDefinition')">PlanDefinition</a></td><td><a class="blue" onclick="fhir_info('SubstanceSpecification')">SubstanceSpecification</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('ChargeItemDefinition')">ChargeItemDefinition</a></td><td><a class="blue" onclick="fhir_info('EpisodeOfCare')">EpisodeOfCare</a></td><td><a class="blue" onclick="fhir_info('MedicationKnowledge')">MedicationKnowledge</a></td><td><a class="blue" onclick="fhir_info('Practitioner')">Practitioner</a></td><td><a class="blue" onclick="fhir_info('SupplyDelivery')">SupplyDelivery</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('Claim')">Claim</a></td><td><a class="blue" onclick="fhir_info('EventDefinition')">EventDefinition</a></td><td><a class="blue" onclick="fhir_info('MedicationRequest')">MedicationRequest</a></td><td><a class="blue" onclick="fhir_info('PractitionerRole')">PractitionerRole</a></td><td><a class="blue" onclick="fhir_info('SupplyRequest')">SupplyRequest</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('ClaimResponse')">ClaimResponse</a></td><td><a class="blue" onclick="fhir_info('Evidence')">Evidence</a></td><td><a class="blue" onclick="fhir_info('MedicationStatement')">MedicationStatement</a></td><td><a class="blue" onclick="fhir_info('Procedure')">Procedure</a></td><td><a class="blue" onclick="fhir_info('Task')">Task</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('ClinicalImpression')">ClinicalImpression</a></td><td><a class="blue" onclick="fhir_info('EvidenceVariable')">EvidenceVariable</a></td><td><a class="blue" onclick="fhir_info('MedicinalProduct')">MedicinalProduct</a></td><td><a class="blue" onclick="fhir_info('Provenance')">Provenance</a></td><td><a class="blue" onclick="fhir_info('TerminologyCapabilities')">TerminologyCapabilities</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('CodeSystem')">CodeSystem</a></td><td><a class="blue" onclick="fhir_info('ExampleScenario')">ExampleScenario</a></td><td><a class="blue" onclick="fhir_info('MedicinalProductAuthorization')">MedicinalProductAuthorization</a></td><td><a class="blue" onclick="fhir_info('Questionnaire')">Questionnaire</a></td><td><a class="blue" onclick="fhir_info('TestReport')">TestReport</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('Communication')">Communication</a></td><td><a class="blue" onclick="fhir_info('ExplanationOfBenefit')">ExplanationOfBenefit</a></td><td><a class="blue" onclick="fhir_info('MedicinalProductContraindication')">MedicinalProductContraindication</a></td><td><a class="blue" onclick="fhir_info('QuestionnaireResponse')">QuestionnaireResponse</a></td><td><a class="blue" onclick="fhir_info('TestScript')">TestScript</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('CommunicationRequest')">CommunicationRequest</a></td><td><a class="blue" onclick="fhir_info('FamilyMemberHistory')">FamilyMemberHistory</a></td><td><a class="blue" onclick="fhir_info('MedicinalProductIndication')">MedicinalProductIndication</a></td><td><a class="blue" onclick="fhir_info('RelatedPerson')">RelatedPerson</a></td><td><a class="blue" onclick="fhir_info('ValueSet')">ValueSet</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('CompartmentDefinition')">CompartmentDefinition</a></td><td><a class="blue" onclick="fhir_info('Flag')">Flag</a></td><td><a class="blue" onclick="fhir_info('MedicinalProductIngredient')">MedicinalProductIngredient</a></td><td><a class="blue" onclick="fhir_info('RequestGroup')">RequestGroup</a></td><td><a class="blue" onclick="fhir_info('VerificationResult')">VerificationResult</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('Composition')">Composition</a></td><td><a class="blue" onclick="fhir_info('Goal')">Goal</a></td><td><a class="blue" onclick="fhir_info('MedicinalProductInteraction')">MedicinalProductInteraction</a></td><td><a class="blue" onclick="fhir_info('ResearchDefinition')">ResearchDefinition</a></td><td><a class="blue" onclick="fhir_info('VisionPrescription')">VisionPrescription</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('ConceptMap')">ConceptMap</a></td><td><a class="blue" onclick="fhir_info('GraphDefinition')">GraphDefinition</a></td><td><a class="blue" onclick="fhir_info('MedicinalProductManufactured')">MedicinalProductManufactured</a></td><td><a class="blue" onclick="fhir_info('ResearchElementDefinition')">ResearchElementDefinition</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('Condition')">Condition</a></td><td><a class="blue" onclick="fhir_info('Group')">Group</a></td><td><a class="blue" onclick="fhir_info('MedicinalProductPackaged')">MedicinalProductPackaged</a></td><td><a class="blue" onclick="fhir_info('ResearchStudy')">ResearchStudy</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('Consent')">Consent</a></td><td><a class="blue" onclick="fhir_info('GuidanceResponse')">GuidanceResponse</a></td><td><a class="blue" onclick="fhir_info('MedicinalProductPharmaceutical')">MedicinalProductPharmaceutical</a></td><td><a class="blue" onclick="fhir_info('ResearchSubject')">ResearchSubject</a></td></tr>
<tr><td><a class="blue" onclick="fhir_info('Contract')">Contract</a></td><td><a class="blue" onclick="fhir_info('HealthcareService')">HealthcareService</a></td><td><a class="blue" onclick="fhir_info('MedicinalProductUndesirableEffect')">MedicinalProductUndesirableEffect</a></td><td><a class="blue" onclick="fhir_info('RiskAssessment')">RiskAssessment</a></td></tr>
</table><br>
<hr>
<br>
&nbsp&nbsp<p><a href="https://script.google.com/macros/s/AKfycbxKGMZUHoJHvy9msuk_oaInH85nbkzPVsaNkkHTrIA/dev">Infobase Google App</a></p>
<br/>

<script>
	let api_hdr = "http://hapi.fhir.org/baseR4/";
	let home_url = "https://wingsmaker.github.io/crypto/";
	let workflow_html = document.getElementById("result").innerHTML;  
	let prev_html = workflow_html;	
	document.getElementById("prev").style.visibility = "hidden";

	function goback() {
		var url = home_url + "Infobase.html";
		window.top.location.href = url;
	}

	function prev_page() {
		var curr_html = document.getElementById("result").innerHTML;
		document.getElementById("result").innerHTML = ( curr_html == prev_html) ? workflow_html : prev_html;
		curr_html = document.getElementById("result").innerHTML;
		document.getElementById("prev").style.visibility = ( curr_html == workflow_html) ? "hidden" : "visible";
	}

	function json2html(resp, resp_title) {
		var ref_pattern = /[A-Z].*[a-z]\/.*[0-9].*[^=]$/;
		var resp_list = resp.split('\n');
		resp_list = resp_list.filter(function(x) { return x.includes(":") && x.length > 0 } );
		resp_list = resp_list.filter(function(x) { return x.split(":")[1].includes('"') } );
		resp_list = resp_list.map(function(x) { return x.replace('",','').replaceAll('"','') });
		resp_list = resp_list.map(function(x) { return x.split(': ') });
		resp_list = resp_list.filter(function(x) { return x.length == 2 } );
		resp_list = resp_list.filter(function(x) { return x[1].length < 120 } );
		var resp_list1 = resp_list;
		var resp_list2 = resp_list;  
		resp_list1 = resp_list1.filter(function(x) { return (x[1].match(ref_pattern) && x[1].length < 80) } );
		resp_list2 = resp_list2.filter(function(x) { return (x[1].match(ref_pattern) && x[1].length < 80)?false:true;});
		var resp_list3 = resp_list1.map(function(x) { return x[1] });
		resp_list3 = resp_list3.map(function(x) { return x.replaceAll(api_hdr,'') });
		resp_list3 = resp_list3.filter(function(x) { return x.includes("http://") == false } );
		resp_list3 = resp_list3.filter(function(x) { return x.match(/^[A-Za-z].*/) } );
		resp_list3 = resp_list3.map(function(x) { return x.replace('/','_').split('/')[0].replace('_','/') });
		resp_list3 = resp_list3.sort();  
		resp_list3 = [...new Set(resp_list3)];
		var resp_list4 = resp_list3.map(function(x) { return x.split('/')[0] });
		resp_list4 = resp_list4.sort();
		resp_list4 = [...new Set(resp_list4)];
		var resp_txt = "";
		resp_list4.forEach( function(x){ resp_txt += (x + '<br/>\n&nbsp&nbsp&nbsp' + resp_list3.filter( function(y) { return y.includes( x + '/')} ).map( function(z) { return html_ref(z) }).join('<br/>\n&nbsp&nbsp&nbsp') + '<br/>\n') }) ;
		var resp_html = '<div style="width: 90%; font-size: 16px;"><h2>' + resp_title + '</h2><br/><br/>';
		if (resp_txt.length > 0 ) {
			resp_html += '<p>Reference info:</p>' + resp_txt + '<br/><br/>';
		} else {
			resp_html += "<br/>";
		}
		resp_html = resp_html + list2html(resp_list) + "</div>";
		document.getElementById("prev").style.visibility = "visible";
		return resp_html;
	}

	function list2html(resp_list) {
		var resp_html = resp_list.map(function(x) { return x.map(function(y) { return "<td>" + y + "</td>" })});
		resp_html = resp_html.map(function(x) { return "<tr>" + x.join('') + "</tr>" });
		resp_html = '<table class="fhir"><tr><th style="width: 20%">Code</th><th style="width: 70%">Desc</th></tr>' + resp_html.join('') + '</table>';
		return resp_html;
	}

	function html_ref(tag) {
		var ref_pattern = /[A-Z].*[a-z]\/.*[0-9].*[^=]$/;
		if ( tag.match(ref_pattern) ) {
			var tag_list = tag.split('/');
			var varx = tag_list[0];
			var vary = tag_list[1];
			var varz = '<a class="blue" onclick="fhir_info(\'' + varx + '\',\'' + vary + '\')">' + vary + '</a>';
			return varz;
		}
		return tag;
	}
	
	function fhir_info(api_name) {
		var apiurl = api_hdr + api_name + "/_history";   
		var resp = "";
		var resp_title = api_name + " summary";    
			prev_html = document.getElementById("result").innerHTML;
		fetch(apiurl)
			.then( resp => resp.text() )
			.then( x => json2html(x, resp_title) )
			.then( y => document.getElementById("result").innerHTML = y );		
	}
</script>
</body>
</html>
